# De-Bruijn Experiment

This project is about the reconstruction of haplotypes in de Bruijn graphs. It aims to enhance de Bruijn graphs with minimal supplementary information, to enable lossless reconstruction of the input haplotypes stored in the graph.

## Compiling the code
This project is coded in rust. To install Rust, please follow the instruction on this [page](https://www.rust-lang.org/tools/install).

Once this is done, the recommended way to install the tool is to clone the git repository and compile it using cargo, the official rust package manager:

```bash
git clone https://github.com/flopau76/dBG_project.git
cd dBG_project
cargo build --release --manifest-path rust_dbg/Cargo.toml
export PATH=$PATH:"$PWD/rust_dbg/target/release"
```

## Generating input files
Several pangenomes in FASTA format can be downloaded from [Zenodo](https://zenodo.org/records/7937947). Those datasets are compressed with bgzip and sequences follow the [panSN-spec](https://github.com/pangenome/PanSN-spec) naming convention.

The tool takes as an input a list of unitigs, as generated by [ggcat](https://github.com/algbio/ggcat). The unitigs can be created from (bgzipped) fasta files with the following command:
```bash
ggcat build -k $K_SIZE $INPUT_FASTA -o $OUTPUT_UNITIGS --min-multiplicity 1
```

## Generating a graph
First of all, we must convert the list of unitigs into a binary graph, with the following command:
```bash
rust_dbg -k $K_SIZE build -i $INPUT_PATH -o  $OUTPUT_PATH 
```
By default, kmers are considered as canonical. If not, use the flag `--forward-only`.

> [!NOTE]
> The kmer size and the flag `--forward-only` (if used) must be identical to generate the list of unitigs and to build the graph.

## En-/decoding a path
The core of the project consists in embedding continuous sequences as paths in the graph. Those paths are described in a custom text format. To generate one, use the command `encode`:
```bash
rust_dbg -k $K_SIZE encode -i $INPUT_FASTA -o $OUTPUT_ENCODING -g $PATH_GRAPH 
```
The encoding is composed of a start node, and a list of extensions of the following format:
- SP(target node): shortest path to the given node
- NN(next node): 2 bit encoding of the following node to add
- R(pattern size)x(nb of repetitions): repetition

> [!NOTE]
> The encoding is not lossless. For now, when a shortest path is specified, it is guarantied that the input path is one of the shortest paths to the target node, but it may not be the only one.

The command `decode` performs the reverse operation, by retrieving a sequence from a path:
```bash
rust_dbg -k $K_SIZE decode -i $INPUT_ENCODING -o $OUTPUT_FASTA -g $PATH_GRAPH
```
## Stats
Some basic stats on the graph can be obtained with the command `stats-g`:
```bash
rust_dbg -k $K_SIZE stats-g -i $PATH_GRAPH
```
For an already encoded path, the command `stats-p` will print some information about the weight and the efficiency of the encoding.
```bash
rust_dbg -k $K_SIZE stats-p -i $INPUT_ENCODING -g $PATH_GRAPH
```